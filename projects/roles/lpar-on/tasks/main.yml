---
# tasks file for roles/lpar


- name: Include credentials for connecting to the HMC
  include_vars:
    file: credentials.yml

- name: Debug Messages
  debug:
    msg: '{{lpar_servers}}'

- name: Activating {{businessService}} LPARs in DCP
  ansible.builtin.script: 'activateLPAR.sh {{item.LPARNAME}} {{hmc_user}} {{hmc_hostname}} {{item.PRI_SYS}}' 
  register: resultadodcp
  loop: '{{ lpar_servers }}'
  when: centro_datos=='DCP'

- name: Activating {{businessService}} LPARs in DCA
  ansible.builtin.script: 'activateLPAR.sh {{item.LPARNAME}} {{hmc_user}} {{hmc_hostname}} {{item.SEC_SYS}}' 
  register: resultadodca
  loop: '{{ lpar_servers }}'
  when: centro_datos=='DCA'

- name: Clean loop output
  set_fact:
    clean_out: '{{ clean_out|default([]) + [item.stdout] }}'
  with_items:
    - '{{ resultadodcp.results }}'
  no_log: True
  when: centro_datos=='DCP'

- name: Clean loop output
  set_fact:
    clean_out: '{{ clean_out|default([]) + [item.stdout] }}'
  with_items:
    - '{{ resultadodca.results }}'
  no_log: True
  when: centro_datos=='DCA'

- name: Debug Messages
  debug:
    msg: '{{clean_out}}'

  